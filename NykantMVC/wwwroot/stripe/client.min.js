function stripePaymentMethodHandler(n){n.error?showError(n.error):$.ajax({type:"POST",url:"/Payment/Payment",data:AddAntiforgeryToken({paymentMethodId:n.paymentMethod.id})}).then(function(n){handleServerResponse(n)})}function handleServerResponse(n){n.error?showError(n.error):n.requires_action?stripe.handleCardAction(n.payment_intent_client_secret).then(handleStripeJsResult):orderComplete(n.intentId)}function handleStripeJsResult(n){n.error?showError(n.error):$.ajax({url:"/payment/confirmpayment",type:"POST",data:AddAntiforgeryToken({paymentIntentId:n.paymentIntent.id})}).then(handleServerResponse)}var stripePKKey=document.getElementById("stripe-key").getAttribute("data-stripePKKey"),stripe=Stripe(stripePKKey),elements=stripe.elements(),url=document.getElementById("stage").dataset.url,style={base:{backgroundColor:"#F7F5F2",textAlign:"left",color:"#777069",fontFamily:"Lato, sans-serif",fontSmoothing:"antialiased",fontSize:"25px","::placeholder":{color:"#777069"},":-webkit-autofill":{color:"#777069",backgroundColor:"#F7F5F2"}},invalid:{fontFamily:"Lato, sans-serif",color:"orange",backgroundColor:"#F7F5F2",iconColor:"#fa755a"}},cardNumber=elements.create("cardNumber",{style:style}),cardExpiry=elements.create("cardExpiry",{style:style}),cardCvc=elements.create("cardCvc",{style:style}),terms_and_conditions,form;cardNumber.mount("#card-element-number");cardExpiry.mount("#card-element-expiry");cardCvc.mount("#card-element-cvc");terms_and_conditions=document.getElementById("terms-and-conditions-consent");form=document.getElementById("payment-form");form.addEventListener("submit",function(n){gtag("event","begin-purchase");n.preventDefault();backbuttonclicked||(loading(!0),terms_and_conditions.checked==!1&&showError("Du skal acceptere vores handelsbetingelser før du kan gennemføre betalingen."),document.getElementById("customer-form-complete").value==0?showError("Du skal udfylde både kunde oplysninger og leveringsmetode formularerne før du kan færdiggøre ordren"):$.ajax({type:"POST",url:"/Payment/PostConsent",data:AddAntiforgeryToken({name:document.getElementById("customer-firstname-summary").textContent,email:document.getElementById("customer-email-summary").textContent})}).then(function(){stripe.createPaymentMethod({type:"card",card:cardNumber,billing_details:{name:document.getElementById("customer-firstname-summary").textContent,email:document.getElementById("customer-email-summary").textContent}}).then(stripePaymentMethodHandler)}))});var showError=function(n){var t,i;t=n.message!=undefined?n.message:n.error!=undefined?n.error:n;i="purchase-error: "+t;Log(i);loading(!1);$("#checkout-modal").css("display","block");document.getElementById("checkout-error").textContent=t;gtag("event",i)},orderComplete=function(n){try{gtag("event","purchase-complete");gtag("event","conversion",{send_to:"AW-10853506642/iWIVCLCt460DENK8rbco",value:1,currency:"DKK",transaction_id:""})}catch(t){}finally{$.ajax({url:"/order/postorder",type:"POST",data:AddAntiforgeryToken({paymentIntentId:n})}).then(function(n){if(n.ok){const i={recipientEmail:n.order.paymentCapture.customer.email,recipientName:n.order.paymentCapture.customer.shippingAddress.name,referenceId:n.order.id,source:"InvitationScript",productSkus:n.productIds,products:n.productList};tp("createInvitation",i);var t=url+"/Bestilling-Gennemført";location.replace(t)}else showError(n.error)})}},loading=function(n){n?(document.querySelector("#paymentspinner").classList.remove("hidden"),document.getElementById("button-text").classList.add("hidden")):(document.querySelector("#paymentspinner").classList.add("hidden"),document.getElementById("button-text").classList.remove("hidden"))};